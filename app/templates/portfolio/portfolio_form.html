{% extends "base.html" %}

{% block title %}{{ 'Edit' if portfolio else 'Create New' }} Portfolio - The Richverse{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/portfolio-form.css') }}">
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="page-heading mb-1">Build your Portfolio in <span class="richverse-title">THE RICHVERSE</span></h1>
        <p class="page-subheading">Travel back to <span class="highlight">1/1/2015</span> with <span class="highlight">$1,000</span>, pick up to <span class="highlight">3 assets</span>, and see your gains today!</p>
    </div>
</div>

<form method="POST" action="{{ url_for('portfolios.edit', portfolio_id=portfolio.portfolio_id) if portfolio else url_for('portfolios.create') }}" id="portfolio-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="row">
        <!-- Asset Selection -->
        <div class="col-12 col-lg-8 order-1">
            <div class="asset-grid">
                {% for asset in assets %}
                <div class="asset-card" data-asset-code="{{ asset.code }}">
                    <div class="asset-icon">
                        <img src="{{ asset.logo_url }}" alt="{{ asset.name }}">
                    </div>
                    <div class="asset-name">{{ asset.name }}</div>
                    <div class="asset-company">{{ asset.company }}</div>
                    <div class="selection-indicator">
                        <i class="bi bi-check"></i>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Portfolio Configuration Sidebar -->
        <div class="col-12 col-lg-4 order-2">
            <div class="card">
                <div class="card-body">
                    <!-- Initial Amount -->
                    <div class="mb-3">
                        <label for="initial_amount" class="form-label">Initial Amount</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="initial_amount" name="initial_amount" 
                                   value="{{ portfolio.initial_amount if portfolio else 1000 }}" readonly>
                        </div>
                    </div>
                    
                    <!-- Start Date -->
                    <div class="mb-3">
                        <label for="start_date" class="form-label">Start from</label>
                        <input type="text" class="form-control" id="start_date" name="start_date" 
                               value="1/1/2015" readonly>
                    </div>
                    
                    <!-- Asset Allocation -->
                    <div class="mb-3">
                        <label class="form-label d-flex justify-content-between align-items-center">
                            <span>Allocation</span>
                            <span class="allocation-total invalid" id="allocation-total">0%</span>
                        </label>
                        
                        <div id="allocation-container" class="card">
                            <div id="no-assets" class="no-assets">
                                <div class="no-assets-icon">
                                    <i class="bi bi-bar-chart"></i>
                                </div>
                                <p>Select at least one asset</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Portfolio Name -->
                    <div class="mb-4">
                        <label for="portfolio_name" class="form-label">Portfolio name</label>
                        <input type="text" class="form-control" id="portfolio_name" name="portfolio_name" 
                               placeholder="Click to edit" value="{{ portfolio.name if portfolio else '' }}" required maxlength="50">
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('portfolios.list') }}" class="btn btn-outline-secondary flex-grow-1">
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary flex-grow-1" id="create-portfolio-btn" disabled>
                            {{ 'Update Portfolio' if portfolio else 'Create Portfolio' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/portfolio.js') }}"></script>
{% endblock %}

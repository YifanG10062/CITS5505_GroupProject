{% extends "base.html" %}

{% block title %}{{ 'Edit' if portfolio else 'Create New' }} Portfolio - The Richverse{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/portfolio-form.css') }}">
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="page-heading mb-1">Build your Portfolio in <span class="richverse-title">THE RICHVERSE</span></h1>
        <p class="page-subheading">Travel back to <span class="highlight">1/1/2015</span> with <span class="highlight">$1,000</span>, pick up to <span class="highlight">3 assets</span>, and see your gains today!</p>
    </div>
</div>

<form method="POST" action="{{ url_for('portfolios.edit', portfolio_id=portfolio.portfolio_id) if portfolio else url_for('portfolios.create') }}" id="portfolio-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="row">
        <!-- Asset Selection -->
        <div class="col-12 col-lg-8 order-1">
            <div class="asset-grid">
                {% for asset in assets %}
                <div class="asset-card" data-asset-code="{{ asset.code }}">
                    <div class="asset-icon">
                        <img src="{{ asset.logo_url }}" alt="{{ asset.name }}">
                    </div>
                    <div class="asset-name">{{ asset.name }}</div>
                    <div class="asset-company">{{ asset.company }}</div>
                    <div class="selection-indicator">
                        <i class="bi bi-check"></i>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Portfolio Configuration Sidebar -->
        <div class="col-12 col-lg-4 order-2">
            <div class="portfolio-config">
                <!-- Initial Amount -->
                <div class="config-item">
                    <div class="config-label">Initial Amount</div>
                    <div class="config-value">$1,000</div>
                    <input type="hidden" id="initial_amount" name="initial_amount" value="1000">
                </div>
                
                <!-- Start Date -->
                <div class="config-item">
                    <div class="config-label">Start From</div>
                    <div class="config-value">1/1/2015</div>
                    <input type="hidden" id="start_date" name="start_date" value="1/1/2015">
                </div>
                
                <!-- Asset Allocation -->
                <div class="config-item allocation-section">
                    <div class="w-100">
                        <div class="allocation-header d-flex justify-content-between align-items-center">
                            <div class="config-label">Allocation</div>
                            <span class="allocation-total invalid" id="allocation-total">0%</span>
                        </div>
                        
                        <div class="allocation-table">
                            <div id="allocation-container">
                                <div id="no-assets" class="no-assets">
                                    <div class="no-assets-icon">
                                        <i class="bi bi-bar-chart"></i>
                                    </div>
                                    <p>Select at least one asset</p>
                                </div>
                                <!-- Allocation items will be dynamically generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Portfolio Name -->
                <div class="config-item portfolio-name-field">
                    <div class="config-label">Portfolio Name</div>
                    <div class="d-flex align-items-center w-100 justify-content-end">
                        <!-- Display View (Default) -->
                        <div class="portfolio-name-display">
                            <img src="{{ url_for('static', filename='icons/edit.svg') }}" alt="Edit" class="edit-icon">
                            <span class="portfolio-name-text {% if not portfolio or not portfolio.name %}empty{% endif %}">
                                {% if portfolio and portfolio.name %}{{ portfolio.name }}{% else %}click to edit{% endif %}
                            </span>
                        </div>
                        
                        <!-- Edit View (Hidden initially) -->
                        <div class="portfolio-name-edit" style="display: none;">
                            <input type="text" class="form-control" id="portfolio_name" name="portfolio_name" 
                                   value="{{ portfolio.name if portfolio and portfolio.name else '' }}" required maxlength="50">
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <a href="{{ url_for('portfolios.list') }}" class="text-link">
                        Cancel
                    </a>
                    <button type="submit" class="btn" id="create-portfolio-btn" disabled>
                        {{ 'Update Portfolio' if portfolio else 'Create Portfolio' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/portfolio.js') }}"></script>
{% endblock %}
